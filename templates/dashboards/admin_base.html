{% load static %}

<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{{ page_title|default:'Admin Dashboard' }} - CIT Shop</title>

    <link rel="stylesheet" href="{% static 'css/admin_base.css' %}?v=1.1">

    {% block extra_css %}{% endblock %}

</head>

<body class="admin-dashboard-body">

    <div class="loader-overlay" id="page-loader">
        <div class="loader-spinner"></div>
    </div>

    <div class="main-content">

    <header class="admin-header">

        <div class="header-left">
            <a href="{% url 'admin_dashboard' %}" class="logo">
                <span class="logo-icon">üê±</span>
                <span class="logo-text">CIT Wildcats Admin</span>
            </a>
        </div>

        <div class="mobile-menu-wrapper">
            <nav class="admin-nav">
                <a href="{% url 'admin_dashboard' %}" class="nav-btn {% if active_page == 'dashboard' %}active{% endif %}">üè† Dashboard</a>
                <a href="{% url 'manage_products' %}" class="nav-btn {% if active_page == 'manage_products' %}active{% endif %}">üì¶ Manage Products</a>
                <a href="{% url 'order_management' %}" class="nav-btn {% if active_page == 'order_management' %}active{% endif %}">üìÖ Order Management</a>
                <a href="{% url 'manage_students' %}" class="nav-btn {% if active_page == 'manage_students' %}active{% endif %}">üë• Manage Students</a>
                <a href="{% url 'reports' %}" class="nav-btn {% if active_page == 'reports' %}active{% endif %}">üìä Reports</a>
            </nav>
            <div class="header-right">
                <a href="{% url 'admin_profile' %}" class="admin-name-link {% if active_page == 'profile' %}active{% endif %}">
                    {% if profile.avatar_url %}
                        <img src="{{ profile.avatar_url }}" alt="Profile" class="header-avatar">
                    {% else %}
                        <span class="header-avatar header-initials-admin">
                            {{ profile.full_name|default:'A'|first|upper }}
                        </span>
                    {% endif %}
                    
                    <span class="admin-name-text">
                        Hello, <strong>{{ display_name|default:'Admin' }}</strong>!
                    </span>
                </a>
                <a href="{% url 'logout' %}" class="logout-btn">Logout</a>
            </div>
        </div>
        
        <button class="hamburger-btn" aria-label="Toggle menu" aria-expanded="false">
            <span class="hamburger-icon">&equiv;</span>
        </button>
    </header>

        <main class="page-container">

                        <ul class="messages" id="message-container">

                {% if messages %}

                    {% for message in messages %}

                        <li class="{{ message.tags }}">{{ message }}</li>

                    {% endfor %}

                {% endif %}

            </ul>

           

            {% block content %}{% endblock %}

</main>
</div>

{% block extra_js %}{% endblock %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // 1. Find the button and the ADMIN header
        const hamburgerBtn = document.querySelector('.hamburger-btn');
        const header = document.querySelector('.admin-header'); // ‚úÖ Changed to admin-header
        const body = document.body;

        if (hamburgerBtn && header && body) {
            
            // 3. Add a click event listener
            hamburgerBtn.addEventListener('click', function() {
                
                // 4. Toggle the '.menu-is-open' class
                header.classList.toggle('menu-is-open');
                
                // 5. Update accessibility
                const isExpanded = header.classList.contains('menu-is-open');
                hamburgerBtn.setAttribute('aria-expanded', isExpanded);

                // 6. Change hamburger icon to 'X' or '‚ò∞'
                const icon = hamburgerBtn.querySelector('.hamburger-icon');
                if (isExpanded) {
                    icon.innerHTML = '&times;'; // 'X' icon
                } else {
                    icon.innerHTML = '&equiv;'; // '‚ò∞' icon
                }
            });
        }

        // ===== NEW: Page Loader Logic =====
        
        // 1. Find the loader element
        const loader = document.getElementById('page-loader');

        // 2. Hide loader on page "show" (for back/forward button)
        window.addEventListener('pageshow', function() {
            if (loader) {
                loader.classList.remove('visible');
            }
        });

        // 3. Show loader on link clicks
        document.addEventListener('click', function(e) {
            // Check if the clicked element is a link (or inside one)
            const link = e.target.closest('a');

            if (link && loader) {
                // --- Filters: Don't show loader for... ---
                
                // (a) Links opening in a new tab
                if (link.target === '_blank') return;
                
                // (b) Simple hash/anchor links on the same page
                if (link.href.startsWith(window.location.href + '#')) return;

                // (c) Mail or Tel links
                if (link.href.startsWith('mailto:') || link.href.startsWith('tel:')) return;

                // (d) Links inside the pagination container
                if (link.closest('.pagination-container')) return;

                // --- Show the loader ---
                loader.classList.add('visible');
            }
        });
        // ==================================
    });
</script>
</body>
</html>