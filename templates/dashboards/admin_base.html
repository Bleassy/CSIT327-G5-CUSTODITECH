{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title|default:'Admin Dashboard' }} - CIT Wildcats Store</title>
    
    <!-- Main base stylesheet for the admin panel -->
    <link rel="stylesheet" href="{% static 'css/admin_base.css' %}?v=1.1">
    <link rel="icon" type="image/png" href="{% static 'images/tablogo.png' %}?v=2">
    <link rel="apple-touch-icon" href="{% static 'images/tablogo.png' %}?v=2">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Django block for extra CSS files on specific pages -->
    {% block extra_css %}{% endblock %}
</head>
<body class="admin-dashboard-body">

    <!-- Page Loader Overlay -->
    <div class="loader-overlay" id="page-loader">
        <div class="loader-spinner"></div>
    </div>

    <!-- Main content wrapper -->
    <div class="main-content">

    <!-- Sticky Header -->
    <header class="admin-header">
        
        <!-- Header Left: Logo -->
        <div class="header-left">
            <a href="{% url 'admin_dashboard' %}" class="logo {% if active_page == 'dashboard' %}active{% endif %}">
                <span class="logo-icon"><i class="fa-solid fa-cat"></i></span>
                <span class="logo-text">CIT Wildcats Admin</span>
            </a>
        </div>

        <!-- Wrapper for navigation and profile, used for mobile menu -->
        <div class="mobile-menu-wrapper">
            
            <!-- Main Navigation Bar -->
            <nav class="admin-nav">
                <a href="{% url 'admin_dashboard' %}" class="nav-btn {% if active_page == 'dashboard' %}active{% endif %}"><i class="fa-solid fa-house"></i> Dashboard</a>
                <a href="{% url 'manage_products' %}" class="nav-btn {% if active_page == 'manage_products' %}active{% endif %}"><i class="fa-solid fa-boxes-stacked"></i> Manage Products</a>
                <a href="{% url 'order_management' %}" class="nav-btn {% if active_page == 'order_management' %}active{% endif %}"><i class="fa-solid fa-clipboard-list"></i> Order Management</a>
                <a href="{% url 'manage_students' %}" class="nav-btn {% if active_page == 'manage_students' %}active{% endif %}"><i class="fa-solid fa-users"></i> Manage Students</a>
                <a href="{% url 'reports' %}" class="nav-btn {% if active_page == 'reports' %}active{% endif %}"><i class="fa-solid fa-chart-bar"></i> Reports</a>
            </nav>
            
            <!-- Header Right: Profile & Logout -->
            <div class="header-right">
                <a href="{% url 'admin_profile' %}" class="admin-name-link {% if active_page == 'profile' %}active{% endif %}">
                    
                    <!-- Display profile avatar if it exists -->
                    {% if profile.avatar_url %}
                        <img src="{{ profile.avatar_url }}" alt="Profile" class="header-avatar">
                    <!-- Otherwise, display initials -->
                    {% else %}
                        <span class="header-avatar header-initials-admin">
                            {{ profile.full_name|default:'A'|first|upper }}
                        </span>
                    {% endif %}
                    
                    <span class="admin-name-text">
                        Hello, <strong>{{ display_name|default:'Admin' }}</strong>!
                    </span>
                </a>
                <a href="{% url 'logout' %}" class="logout-btn">Logout</a>
            </div>
        </div>
        
        <!-- Hamburger Menu Button (visible on mobile) -->
        <button class="hamburger-btn" aria-label="Toggle menu" aria-expanded="false">
            <span class="hamburger-icon">&equiv;</span>
        </button>
    </header>

    <!-- Main Page Content Area -->
    <main class="page-container">

            <!-- Container for Django messages (success, error, etc.) -->
            <ul class="messages" id="message-container">
                {% if messages %}
                    {% for message in messages %}
                        <li class="{{ message.tags }}">{{ message }}</li>
                    {% endfor %}
                {% endif %}
            </ul>
            
            <!-- Django block where child templates will inject their content -->
            {% block content %}{% endblock %}

    </main>
</div>

<!-- Django block for extra JavaScript files on specific pages -->
{% block extra_js %}{% endblock %}

<!-- Base JavaScript for all admin pages -->
<script>
        // --- Page Loader Logic ---
        const loader = document.getElementById('page-loader');

    if (loader) {
        // Hide loader on page "show" (handles back/forward button navigation)
        window.addEventListener('pageshow', function() {
            loader.classList.remove('visible');
        });

        // Show loader on link clicks
        document.addEventListener('click', function(e) {
            const link = e.target.closest('a');

            if (link) {
                
                // --- Filters: Don't show loader for... ---
                if (link.classList.contains('active')) {
                    e.preventDefault(); // This stops the reload
                    return;
                }
                
                // (a) Links opening in a new tab
                if (link.target === '_blank') return;
                
                // (b) Simple hash/anchor links on the same page
                if (link.href.startsWith(window.location.href + '#')) return;

                // (c) Mail or Tel links
                if (link.href.startsWith('mailto:') || link.href.startsWith('tel:')) return;

                // (d) Links inside the pagination container
                if (link.closest('.pagination-container')) return;

                // If no filters match, show the loader
                loader.classList.add('visible');
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        
        // --- Hamburger Menu Logic ---
        const hamburgerBtn = document.querySelector('.hamburger-btn');
        const header = document.querySelector('.admin-header');
        const body = document.body;

        if (hamburgerBtn && header && body) {
            
            hamburgerBtn.addEventListener('click', function() {
                
                // Toggle the '.menu-is-open' class on the header
                header.classList.toggle('menu-is-open');
                
                // Update accessibility attribute
                const isExpanded = header.classList.contains('menu-is-open');
                hamburgerBtn.setAttribute('aria-expanded', isExpanded);

                // Change hamburger icon to 'X' or '☰'
                const icon = hamburgerBtn.querySelector('.hamburger-icon');
                if (isExpanded) {
                    icon.innerHTML = '&times;'; // 'X' icon
                } else {
                    icon.innerHTML = '&equiv;'; // '☰' icon
                }
            });
        }
    });
</script>
</body>
</html>
